<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{product.title}}</title>
    <script>
        // Function to show the selected reviews section
        function showReviews(platform) {
            // Hide all review sections initially
            document.getElementById('amazon-reviews').style.display = 'none';
            document.getElementById('flipkart-reviews').style.display = 'none';
            document.getElementById('cc-reviews').style.display = 'none';

            // Show the selected reviews section
            if (platform === 'amazon') {
                document.getElementById('amazon-reviews').style.display = 'block';
            } else if (platform === 'flipkart') {
                document.getElementById('flipkart-reviews').style.display = 'block';
            } else if (platform === 'cc') {
                document.getElementById('cc-reviews').style.display = 'block';
            }
        }

        // On page load, default to showing CC Reviews
        window.onload = function() {
            showReviews('cc');
        };
    </script>
    <style>
    /* General reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    padding: 20px;
}

/* Main container */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Product details section */
.product-details {
    display: flex;
    gap: 20px;
    margin-bottom: 40px;
}

/* Product image */
.product-image {
    width: 300px;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Product info styling */
.product-info {
    flex: 1;
}

.product-title {
    font-size: 2.5em;
    color: #333;
    margin-bottom: 10px;
}

.product-price {
    font-size: 1.5em;
    color: #e63946;
    margin-bottom: 5px;
}

.product-ccscore {
    font-size: 1.2em;
    color: #4caf50;
    margin-bottom: 5px;
}

.product-online-review {
    font-size: 1.2em;
    color: #888;
    margin-bottom: 5px;
}

.product-description {
    font-size: 1em;
    color: #555;
    margin-top: 20px;
}

/* Reviews section */
.reviews-section {
    margin-top: 50px;
}

.reviews-title {
    font-size: 2em;
    color: #333;
    margin-bottom: 20px;
}

/* Individual review item */
.review-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}

.review-item {
    background-color: #f9f9f9;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.review-author {
    font-size: 1.2em;
    color: #333;
    margin-bottom: 10px;
}

.review-rating {
    font-size: 1.1em;
    color: #4caf50;
    margin-bottom: 5px;
}

.review-comment {
    font-size: 1em;
    color: #555;
}

    </style>
</head>
<body>
    <div class="container">
        <div class="product-details">
            <img src="{{ product.image.url }}" alt="{{ product.title }}" class="product-image">
            <div class="product-info">
                <h1 class="product-title">{{ product.title }}</h1>
                <p class="product-price">Price: ${{ product.price }}</p>
                <p class="product-ccscore">CC Score: {{ product.ccscore }}/5</p>
                <p class="product-online-review">Online Rating: {{ product.online_rating }}</p>
            </div>
        </div>



    <div class="container">
    <h2 class="reviews-title">Customer Reviews</h2>

    <!-- Dropdown to select review source -->
    <select onchange="showReviews(this.value)">
        <option value="cc">CC Reviews</option>
        <option value="amazon">Amazon Reviews</option>
        <option value="flipkart">Flipkart Reviews</option>
    </select>

    <!-- CC Reviews Section (Default) -->
    <div id="cc-reviews" class="reviews-section" style="display: none;">
        {% if writereview %}<a href="/writereview/{{ product.title }}">Write your review</a>{% endif %}
        <h3 class="reviews-title">CC Reviews</h3>
        <div class="review-list">
            {% for review in ccreviews %}
            <div class="review-item" id="review-{{ review.id }}">
                <h3 class="review-author{{ review.consumer.username }}">{{ review.consumer.username }}</h3>
                <p class="review-comment{{ review.consumer.username }}">{{ review.content }}</p>
                <p class="review-rating{{ review.consumer.username }}">Approvals: {{ review.approvalscore }}</p>
                
                <!-- If the logged-in user is the author, show the "Edit" button -->
                {% if review.consumer.username == username %}
                <button onclick="openEditModal('{{ review.content }}', {{ review.id }})">Edit Review</button>
                {% endif %}
            </div>
            
            {% endfor %}
        </div>
    </div>
    

    <!-- Amazon Reviews Section -->
    <div id="amazon-reviews" class="reviews-section" style="display: none;">
        <h3 class="reviews-title">Amazon Reviews</h3>
        <div class="review-list">
            {% for review in product.amazonreviews %}
            <div class="review-item">
                <p class="review-comment">{{ review }}</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Flipkart Reviews Section -->
    <div id="flipkart-reviews" class="reviews-section" style="display: none;">
        <h3 class="reviews-title">Flipkart Reviews</h3>
        <div class="review-list">
            {% for review in product.flipkartreviews %}
            <div class="review-item">
                <p class="review-comment">{{ review }}</p>
            </div>
            {% endfor %}
        </div>
    </div>

</div>

    </div>
    <div id="editReviewModal" style="display: none;">
        <div style="background: rgba(0, 0, 0, 0.5); position: fixed; top: 0; left: 0; right: 0; bottom: 0;">
            <div style="background: white; padding: 20px; margin: 100px auto; width: 50%; border-radius: 8px;">
                <h2>Edit Your Review</h2>
                <form id="editReviewForm">
                    {% csrf_token %}
                    <input type="hidden" id="edit-username" name="username" value="{{username}}">
                    <input type="hidden" id="edit-product" name="product" value="{{product.title}}">
                    <textarea id="edit-review-content" name="content" rows="4" style="width: 100%;"></textarea>
                    <button type="submit" style="margin-top: 10px;">Save Changes</button>
                    <button type="button" onclick="closeEditModal()" style="margin-top: 10px;">Cancel</button>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // AJAX function to handle form submission and update review content on the page
        document.getElementById('editReviewForm').onsubmit = function(event) {
            event.preventDefault(); // Prevent default form submission
    
            const username = document.getElementById('edit-username').value;
            const product = document.getElementById('edit-product').value;
            const content = document.getElementById('edit-review-content').value;
    
            // Make AJAX request
            fetch('/editreview/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}' // Django CSRF token
                },
                body: JSON.stringify({
                    username: username,
                    product: product,
                    content: content
                })
            })
            .then(response => response.json())
            .then(data => {
    if (data.success) {
        // Find the review and update its content using the new content from the response
        const reviewElement = document.getElementsByClassName(`review-comment${data.username}`)[0];
        if (reviewElement) {
            console.log(reviewElement);
            // Update the review comment with the new content returned from the backend
            reviewElement.textContent = data.content;
            reviewElement.body = data.content;
        }

        // Close the modal
        closeEditModal();
    } else {
        alert("Failed to update review. Please try again.");
    }
})

            .catch(error => {
                console.error('Error:', error);
            });
        };
    
        // Function to open the edit modal and populate it with existing review content
        function openEditModal(content) {
            document.getElementById('edit-review-content').value = content;
            document.getElementById('editReviewModal').style.display = 'block';
        }
    
        // Function to close the edit modal
        function closeEditModal() {
            document.getElementById('editReviewModal').style.display = 'none';
        }
    </script>
        </body>
</html>
